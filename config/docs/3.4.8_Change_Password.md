# 3.4.8 Change Password

## Function trigger
The user clicks on "Change Password" from the Profile page or Settings page, or navigates to the change password section from their account settings.

## Function description
Allows authenticated users (Customer, Driver, Admin) to change their current password to a new password. The user must provide their current password for verification, then enter a new password and confirm it. The system validates the current password before allowing the change, and after successful password change, the user may be required to log in again with the new password.

## Screen layout
The screen consists of:
- Header section with page title "Change Password" or "Đổi mật khẩu"
- Form section containing:
  - Current password input field (password type, required)
  - New password input field (password type, required)
  - Confirm new password input field (password type, required)
  - Password strength indicator (optional)
  - Submit button ("Change Password" or "Đổi mật khẩu")
  - Cancel button or link to return to profile
- Information message or help text explaining password requirements (if any)
- Success/error message display area

## Function details

### Data
- Current password (string, required)
- New password (string, required)
- Confirm new password (string, required)
- User ID (retrieved from authentication token)
- Timestamp of password change (updatedAt)

### Validation
- The user must be authenticated (valid JWT token required).
- Current password field is required and cannot be empty.
- New password field is required and cannot be empty.
- Confirm new password field is required and must match the new password.
- Current password must match the password stored in the database for the authenticated user.
- New password should be different from the current password (optional validation).
- Password fields should not display plain text (use password input type).

### Business rule
- BR-08: Users can only change their password when they are logged in.
- BR-09: After changing the password, the user will be asked to log in again.
- BR-20: The new password must be different from the old password.

### Functionality

#### In Normal Cases:
- The user navigates to the Change Password page from their profile or settings.
- The user enters their current password in the "Current Password" field.
- The user enters a new password in the "New Password" field.
- The user confirms the new password by entering it again in the "Confirm New Password" field.
- The system validates that:
  - All fields are filled
  - Current password matches the user's stored password
  - New password and confirm password match
  - New password is different from current password
- If all validations pass, the system:
  - Hashes the new password using bcrypt
  - Updates the user's passwordHash in the database
  - Updates the user's updatedAt timestamp
  - Returns a success message: "Password changed successfully" or "Đổi mật khẩu thành công"
- The user is optionally logged out and redirected to the login page to log in again with the new password.
- A success notification is displayed to the user.

#### In Abnormal Cases:
- If current password is incorrect → message: "Current password is incorrect" or "Mật khẩu hiện tại không đúng".
- If current password field is empty → message: "Current password is required" or "Vui lòng nhập mật khẩu hiện tại".
- If new password field is empty → message: "New password is required" or "Vui lòng nhập mật khẩu mới".
- If confirm password field is empty → message: "Please confirm your new password" or "Vui lòng xác nhận mật khẩu mới".
- If new password and confirm password do not match → message: "New password and confirmation do not match" or "Mật khẩu mới và xác nhận không khớp".
- If new password is the same as current password → message: "New password must be different from current password" or "Mật khẩu mới phải khác mật khẩu hiện tại".
- If user is not authenticated → system returns 401 Unauthorized error with message: "Please log in to change your password" or "Vui lòng đăng nhập để đổi mật khẩu".
- If database update fails → message: "Unable to change password. Please try again later." or "Không thể đổi mật khẩu. Vui lòng thử lại sau."
- If user account is not found → message: "User account not found" or "Không tìm thấy tài khoản".


